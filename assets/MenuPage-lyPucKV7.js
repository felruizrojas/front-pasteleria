import{c as L,_ as U,a as W,b as Y,d as G,e as H,f as Q,g as X,h as ee,i as ae,j as te,k as oe,l as se,m as re,n as ce,o as le,p as ie,q as ne}from"./menu_datos-Ao8HE8cF.js";import{j as e,e as I,r as p,L as de}from"./index-CqkjqQ36.js";import{B as M}from"./Input-Bel9z8HH.js";const ue=({categories:s,productOptions:o,orderOptions:r,selectedCategory:d,selectedProductCode:m,minPrice:x,maxPrice:g,sortOrder:v,errors:b,onCategoryChange:y,onProductChange:S,onMinPriceChange:j,onMaxPriceChange:h,onSortChange:f,onReset:F})=>{const N=c=>{const _=c.nativeEvent,C=_.inputType??"";if(C.startsWith("delete")||C==="insertReplacementText")return;const P=_.data??"";P.length!==0&&(/^[0-9]+$/.test(P)||c.preventDefault())};return e.jsx("div",{className:"menu-toolbar shadow-soft mb-4",children:e.jsxs("div",{className:"row g-3 align-items-end",children:[e.jsxs("div",{className:"col-12 col-lg-2",children:[e.jsx("label",{className:"form-label fw-semibold",htmlFor:"categoryFilter",children:"Categoría"}),e.jsxs("select",{id:"categoryFilter",className:"form-select",value:d==="all"?"all":String(d),onChange:c=>{const{value:_}=c.target;y(_==="all"?"all":Number(_))},children:[e.jsx("option",{value:"all",children:"Todas"}),s.map(c=>e.jsx("option",{value:c.id_categoria,children:c.nombre_categoria},c.id_categoria))]})]}),e.jsxs("div",{className:"col-12 col-lg-2",children:[e.jsx("label",{className:"form-label fw-semibold",htmlFor:"productFilter",children:"Producto"}),e.jsxs("select",{id:"productFilter",className:"form-select",value:m==="all"?"all":m,onChange:c=>{const{value:_}=c.target;S(_==="all"?"all":_)},disabled:o.length===0,children:[e.jsx("option",{value:"all",children:"Todos"}),o.map(c=>e.jsx("option",{value:c.codigo_producto,children:c.nombre_producto},c.codigo_producto))]})]}),e.jsxs("div",{className:"col-6 col-lg-2",children:[e.jsx("label",{className:"form-label fw-semibold",htmlFor:"priceMin",children:"Precio mín."}),e.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",id:"priceMin",className:`form-control${b.precioMin?" is-invalid":""}`,placeholder:"0",value:x,onBeforeInput:N,onChange:c=>j(c.target.value)}),b.precioMin?e.jsx("div",{className:"invalid-feedback d-block",children:b.precioMin}):null]}),e.jsxs("div",{className:"col-6 col-lg-2",children:[e.jsx("label",{className:"form-label fw-semibold",htmlFor:"priceMax",children:"Precio máx."}),e.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",id:"priceMax",className:`form-control${b.precioMax?" is-invalid":""}`,placeholder:"∞",value:g,onBeforeInput:N,onChange:c=>h(c.target.value)}),b.precioMax?e.jsx("div",{className:"invalid-feedback d-block",children:b.precioMax}):null]}),e.jsxs("div",{className:"col-12 col-lg-2",children:[e.jsx("label",{className:"form-label fw-semibold",htmlFor:"orderSelect",children:"Ordenar"}),e.jsx("select",{id:"orderSelect",className:"form-select",value:v,onChange:c=>f(c.target.value),children:r.map(c=>e.jsx("option",{value:c.value,children:c.label},c.value))})]}),e.jsx("div",{className:"col-12 col-lg-2 d-flex align-items-end justify-content-center justify-content-lg-start",children:e.jsx(M,{type:"button",variant:"mint",className:"w-100",onClick:F,children:"Limpiar"})})]})})},z=s=>{const o=s.trim();if(!o)return null;const r=Number(o);return Number.isNaN(r)?null:r},V=s=>{const o={},r=z(s.precioMin),d=z(s.precioMax);return r!==null&&r<0&&(o.precioMin=I.negativePrice),d!==null&&d<0&&(o.precioMax=I.negativePrice),r!==null&&d!==null&&r>d&&(o.precioMax=I.priceOrder),{isValid:Object.keys(o).length===0,errors:o}},me=[{value:"name-asc",label:"Nombre: A → Z"},{value:"name-desc",label:"Nombre: Z → A"},{value:"price-asc",label:"Precio: menor a mayor"},{value:"price-desc",label:"Precio: mayor a menor"}],$=typeof window<"u",pe=Object.assign({"/src/assets/images/catalog/brownie_sin_gluten.jpg":ne,"/src/assets/images/catalog/cheesecake_sin_azucar.jpg":ie,"/src/assets/images/catalog/empanada_de_manzana.jpg":le,"/src/assets/images/catalog/galletas_veganas_de_avena.jpg":ce,"/src/assets/images/catalog/mousse_de_chocolate.jpg":re,"/src/assets/images/catalog/pan_sin_gluten.jpg":se,"/src/assets/images/catalog/tarta_de_santiago.jpg":oe,"/src/assets/images/catalog/tiramisu_clasico.jpg":te,"/src/assets/images/catalog/torta_circular_de_manjar.jpg":ae,"/src/assets/images/catalog/torta_circular_de_vainilla.jpg":ee,"/src/assets/images/catalog/torta_cuadrada_de_chocolate.jpg":X,"/src/assets/images/catalog/torta_cuadrada_de_frutas.jpg":Q,"/src/assets/images/catalog/torta_especial_de_boda.jpg":H,"/src/assets/images/catalog/torta_especial_de_cumpleanos.jpg":G,"/src/assets/images/catalog/torta_sin_azucar_de_naranja.jpg":Y,"/src/assets/images/catalog/torta_vegana_de_chocolate.jpg":W}),R=Object.entries(pe).reduce((s,[o,r])=>{const d=o.split("/").pop();return d&&(s[d]=r),s},{}),ge=s=>{const o=s.split("/").pop();if(o&&R[o])return R[o];const r=s.replace(/^img\//,"images/").replace("catalogo","catalog");return new URL(Object.assign({"/src/assets/index.ts":U})[`@/assets/${r}`],import.meta.url).href},_e=s=>s.toLocaleString("es-CL",{style:"currency",currency:"CLP",maximumFractionDigits:0}),A=s=>{const o=s.trim();if(!o)return null;const r=Number(o);return Number.isNaN(r)?null:r},D=s=>{const o=s.replace(/[^0-9]/g,"");if(!o)return"";const r=Number(o);return Number.isNaN(r)?"":r.toString()},O="carrito",B=(s,o)=>{if(!$)return o;try{const r=window.localStorage.getItem(s);return r?JSON.parse(r):o}catch{return o}},be=(s,o)=>{if($)try{window.localStorage.setItem(s,JSON.stringify(o))}catch{}},xe=(s,o)=>{const r=B(O,[]),d=s.codigo_producto.toLowerCase(),m=r.findIndex(g=>g.codigo.toLowerCase()===d),x=s.stock??1/0;if(m>=0){const g=Number(r[m].cantidad??0);r[m].cantidad=Math.min(g+o,x)}else r.push({codigo:s.codigo_producto,cantidad:Math.min(o,x)});be(O,r)},je=()=>{const[s,o]=p.useState("all"),[r,d]=p.useState("all"),[m,x]=p.useState(""),[g,v]=p.useState(""),[b,y]=p.useState("name-asc"),[S,j]=p.useState({}),h=p.useMemo(()=>new Intl.Collator("es",{sensitivity:"base"}),[]),f=p.useMemo(()=>L.categorias.flatMap(a=>a.productos.map(l=>({...l,categoriaId:a.id_categoria,categoriaNombre:a.nombre_categoria}))),[]),F=p.useMemo(()=>{const a=s==="all"?f:f.filter(t=>t.categoriaId===s),l=new Map;return a.forEach(t=>{l.has(t.codigo_producto)||l.set(t.codigo_producto,t)}),Array.from(l.values()).sort((t,n)=>h.compare(t.nombre_producto,n.nombre_producto))},[f,s,h]),N=p.useMemo(()=>{const a=A(m),l=A(g);let t=f;s!=="all"&&(t=t.filter(i=>i.categoriaId===s)),r!=="all"&&(t=t.filter(i=>i.codigo_producto===r)),a!==null&&(t=t.filter(i=>i.precio_producto>=a)),l!==null&&(t=t.filter(i=>i.precio_producto<=l));const n=[...t];switch(b){case"name-desc":n.sort((i,u)=>h.compare(u.nombre_producto,i.nombre_producto));break;case"price-asc":n.sort((i,u)=>i.precio_producto-u.precio_producto);break;case"price-desc":n.sort((i,u)=>u.precio_producto-i.precio_producto);break;case"name-asc":default:n.sort((i,u)=>h.compare(i.nombre_producto,u.nombre_producto))}return n},[f,s,r,m,g,b,h]),c=N.length,_=()=>{o("all"),d("all"),x(""),v(""),y("name-asc"),j({})},C=a=>{o(a),d("all")},P=a=>{const l=D(a);let t=g;const n=l?Number(l):null,i=g?Number(g):null;n!==null&&i!==null&&n>i&&(t=l,v(t)),x(l);const u=V({precioMin:l,precioMax:t});j(u.errors)},J=a=>{const l=D(a);let t=l;const n=m?Number(m):null,i=l?Number(l):null;n!==null&&i!==null&&i<n&&(t=m),v(t);const u=V({precioMin:m,precioMax:t});j(u.errors)},q=async a=>{if(!$)return;const l=`${window.location.origin}/menu/${a.codigo_producto}`,t={title:a.nombre_producto,text:`Descubre ${a.nombre_producto} de Pastelería Mil Sabores`,url:l};try{if(navigator.share){await navigator.share(t);return}navigator.clipboard?.writeText&&(await navigator.clipboard.writeText(l),window.alert("Enlace copiado al portapapeles"))}catch{window.alert("No fue posible compartir el producto. Intenta nuevamente más tarde.")}},[k,T]=p.useState({}),w=p.useRef({}),E=(a,l)=>{const t=String(a);T(n=>({...n,[t]:l})),w.current[t]&&window.clearTimeout(w.current[t]),w.current[t]=window.setTimeout(()=>{T(n=>({...n,[t]:null})),w.current[t]=null},3500)},Z=a=>{const l=B(O,[]),t=a.codigo_producto.toLowerCase(),n=l.filter(u=>u.codigo?.toLowerCase()===t).reduce((u,K)=>u+Number(K.cantidad??0),0),i=a.stock??0;if(n>=i){E(a.codigo_producto,{text:`Sin stock suficiente. Máximo ${i} ${i===1?"unidad disponible":"unidades disponibles"}.`,tone:"danger"});return}xe(a,1),E(a.codigo_producto,{text:"Producto agregado al carrito",tone:"success"})};return p.useEffect(()=>()=>{Object.values(w.current).forEach(a=>{a&&window.clearTimeout(a)})},[]),e.jsx("section",{className:"py-4 py-lg-5",children:e.jsxs("div",{className:"container",children:[e.jsxs("header",{className:"text-center mb-4 mb-lg-5",children:[e.jsx("h1",{className:"section-title mb-2",children:"Nuestra Carta"}),e.jsx("p",{className:"mb-0",children:"Explora nuestras categorías y encuentra el postre ideal para celebrar."})]}),e.jsx(ue,{categories:L.categorias,productOptions:F,orderOptions:me,selectedCategory:s,selectedProductCode:r,minPrice:m,maxPrice:g,sortOrder:b,errors:S,onCategoryChange:C,onProductChange:d,onMinPriceChange:P,onMaxPriceChange:J,onSortChange:y,onReset:_}),e.jsx("div",{className:"d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3",children:e.jsx("p",{className:"mb-0",children:c===0?"Sin productos visibles.":`${c} ${c===1?"producto disponible":"productos disponibles"}`})}),c===0?e.jsxs("div",{className:"menu-empty card-soft text-center py-5",children:[e.jsx("p",{className:"mb-2 fw-semibold",children:"No encontramos productos con los filtros seleccionados."}),e.jsx("p",{className:"mb-4",children:"Ajusta los criterios o vuelve a mostrar toda la carta."}),e.jsx(M,{type:"button",variant:"mint",onClick:_,children:"Ver carta completa"})]}):e.jsx("div",{className:"row g-4",children:N.map(a=>e.jsx("div",{className:"col-12 col-md-6 col-lg-4",children:e.jsxs("div",{className:"card card-soft shadow-soft h-100 product-card",children:[e.jsx(de,{to:`/menu/${a.codigo_producto}`,className:"ratio ratio-4x3",children:e.jsx("img",{src:ge(a.imagen_producto),alt:a.nombre_producto,className:"w-100 h-100 object-fit-cover",loading:"lazy"})}),e.jsxs("div",{className:"card-body d-flex flex-column gap-2 text-center",children:[e.jsx("p",{className:"text-uppercase small text-muted mb-1",children:a.categoriaNombre}),e.jsx("h3",{className:"h5 mb-0",children:a.nombre_producto}),e.jsx("p",{className:"fw-semibold mb-0",children:_e(a.precio_producto)}),e.jsx("p",{className:"mb-3 text-muted flex-grow-1",children:a.descripción_producto}),e.jsxs("div",{className:"d-grid gap-2",children:[e.jsx(M,{as:"link",to:`/menu/${a.codigo_producto}`,variant:"strawberry",block:!0,children:"Ver detalle y personalizar"}),e.jsxs(M,{type:"button",variant:"mint",block:!0,onClick:()=>Z(a),children:[e.jsx("i",{className:"bi bi-cart-plus","aria-hidden":"true"})," Añadir al carrito"]}),e.jsxs(M,{type:"button",variant:"mint",block:!0,onClick:()=>q(a),children:[e.jsx("i",{className:"bi bi-share","aria-hidden":"true"})," Compartir"]})]}),k[a.codigo_producto]?e.jsx("div",{className:`small ${k[a.codigo_producto]?.tone==="danger"?"text-danger":k[a.codigo_producto]?.tone==="success"?"text-success":""}`,role:"status","aria-live":"polite",children:k[a.codigo_producto]?.text}):null]})]})},a.codigo_producto))})]})})};export{je as default};
