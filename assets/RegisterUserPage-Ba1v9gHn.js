import{u as K,a as _,r as d,g as q,j as e,L as G,c as S,s as Y}from"./index-CtA74-58.js";import{B as P,I as f}from"./Input-CJ-O810F.js";import{l as J}from"./logo_tienda-CU7G0dT7.js";import{v,M as Q,m as W,a as X,s as Z}from"./userValidations-DoQ_YzLs.js";import{u as ee}from"./useAuth-CsPYcmks.js";const ae="/front-pasteleria/assets/diversidad_pasteles-BPCuRbrV.jpg",ie=()=>{const j=K(),D=j.pathname,N=_(),{login:A}=ee(),[y,E]=d.useState([]),[r,x]=d.useState({run:"",runBody:"",runDigit:"",nombre:"",apellidos:"",correo:"",fechaNacimiento:"",regionId:"",comuna:"",direccion:"",password:"",confirmPassword:"",termsAccepted:!1,codigoDescuento:""}),[s,T]=d.useState({}),[c,u]=d.useState({}),[w,h]=d.useState(null),[C,L]=d.useState(!1),[k,$]=d.useState(!1);d.useEffect(()=>{document.querySelectorAll(".offcanvas.show").forEach(a=>{a instanceof HTMLElement&&(a.classList.remove("show"),a.style.removeProperty("visibility"),a.setAttribute("aria-hidden","true"))}),document.querySelectorAll(".offcanvas-backdrop").forEach(a=>a.remove()),document.body.style.removeProperty("overflow"),document.body.removeAttribute("data-bs-overflow"),document.body.removeAttribute("data-bs-padding-right")},[]),d.useEffect(()=>{const a=q(S.regiones);E(a)},[]);const m=d.useCallback((a,o,l)=>{const n=l??v(a,{mode:"create"}),i={};return Object.keys(o).forEach(t=>{if(!o[t])return;const g=n.errors[t];g&&(i[t]=g)}),T(i),n},[T]),F=d.useMemo(()=>y.find(a=>a.id===r.regionId)?.comunas??[],[y,r.regionId]),p=a=>{const{name:o,value:l}=a.currentTarget,n=o;let i=l;o==="nombre"||o==="apellidos"?i=Z(l):o==="codigoDescuento"&&(i=l.toUpperCase());const t={...r,[n]:i},g=v(t,{mode:"create"}),B={...c};(c[n]||g.errors[n])&&(B[n]=!0),m(t,B,g),x(t),u(B),h(null)},R=a=>{const o=a.currentTarget.checked,l={...r,termsAccepted:o},n=v(l,{mode:"create"}),i={...c,termsAccepted:!0};m(l,i,n),x(l),u(i),h(null)},M=a=>{const o=a.currentTarget.value.replace(/\D/g,"").slice(0,8),l=`${o}${r.runDigit??""}`,n={...r,runBody:o,run:l},i=v(n,{mode:"create"}),t={...c};(c.runBody||i.errors.runBody)&&(t.runBody=!0),(c.run||i.errors.run)&&(t.run=!0),m(n,t,i),x(n),u(t),h(null)},V=a=>{const o=a.currentTarget.value.replace(/[^0-9kK]/g,"").toUpperCase().slice(0,1),l=`${r.runBody??""}${o}`,n={...r,runDigit:o,run:l},i=v(n,{mode:"create"}),t={...c};(c.runDigit||i.errors.runDigit)&&(t.runDigit=!0),i.errors.runBody&&(t.runBody=!0),(c.run||i.errors.run)&&(t.run=!0),m(n,t,i),x(n),u(t),h(null)},I=a=>{const o={...c,[a]:!0,run:!0};m(r,o),u(o)},b=a=>{const{name:o}=a.currentTarget;if(!o)return;const n={...c,[o]:!0};m(r,n),u(n)},z=a=>{const o=a.currentTarget.value,l={...r,regionId:o,comuna:""},n={...c,regionId:!0,comuna:!0};m(l,n),x(l),u(n),h(null)},O=a=>{const o=a.currentTarget.value,l={...r,comuna:o},n={...c,comuna:!0};m(l,n),x(l),u(n),h(null)},U=async a=>{a.preventDefault();const o=Object.keys(r),l={};o.forEach(t=>{l[t]=!0});const n=m(r,l);if(u(l),!n.isValid){h({type:"danger",text:"Por favor corrige los campos marcados."});return}const i=W(r);X(i),Y(S.activeUser,i),h({type:"success",text:"Cuenta creada con éxito. Iniciando sesión..."}),await A({email:r.correo,password:r.password}),N("/",{replace:!0})},H=d.useCallback(a=>{a.preventDefault(),N(`${j.pathname}`,{replace:!0,state:{from:D,openLogin:!0}})},[D,j.pathname,N]);return e.jsxs("main",{className:"mt-0",children:[e.jsx("section",{className:"position-relative overflow-hidden text-white",style:{backgroundImage:`linear-gradient(135deg, rgba(39, 12, 63, 0.75), rgba(233, 30, 99, 0.55)), url(${ae})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"},children:e.jsx("div",{className:"container py-3 position-relative",children:e.jsx("div",{className:"row justify-content-center",children:e.jsx("div",{className:"col-11 col-md-10 col-lg-6",children:e.jsxs("div",{className:"d-flex flex-column flex-lg-row align-items-center gap-3 text-center text-lg-start p-3 p-lg-4 rounded-4 shadow-lg",style:{background:"rgba(31, 8, 56, 0.5)",backdropFilter:"blur(18px)",border:"1px solid rgba(255, 255, 255, 0.2)"},children:[e.jsx("img",{src:J,alt:"Pastelería Mil Sabores",width:140,className:"rounded-pill shadow border border-light border-opacity-50"}),e.jsxs("div",{children:[e.jsx("span",{className:"badge text-uppercase fw-semibold mb-3 bg-white text-body-secondary px-3 py-2",children:"Tu pastelería favorita"}),e.jsx("h1",{className:"mb-2 brand-name text-white",children:"Pastelería Mil Sabores"}),e.jsx("h2",{className:"h4 mb-3",style:{color:"rgba(255, 255, 255, 0.85)"},children:"Crea tu cuenta"}),e.jsx("p",{className:"lead mb-0",style:{color:"rgba(255, 255, 255, 0.9)"},children:"Accede a beneficios dulces, seguimiento de pedidos y novedades exclusivas."})]})]})})})})}),e.jsx("section",{className:"py-5",children:e.jsx("div",{className:"container",children:e.jsx("div",{className:"row justify-content-center",children:e.jsx("div",{className:"col-12 col-lg-8 col-xl-6",children:e.jsxs("div",{className:"bg-body border rounded-3 shadow-sm p-4 p-lg-5",children:[e.jsxs("header",{className:"d-flex align-items-start justify-content-between mb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"badge text-uppercase fw-semibold mb-2",children:"Nuevo registro"}),e.jsxs("h2",{className:"h4 mb-0",children:[e.jsx("i",{className:"bi bi-person-plus me-2","aria-hidden":"true"}),"Crear cuenta"]})]}),e.jsx(P,{as:"link",to:"/",size:"sm",variant:"mint","aria-label":"Volver al inicio",children:e.jsx("i",{className:"bi bi-x-lg","aria-hidden":"true"})})]}),e.jsx("p",{className:"mb-4",children:"Completa tus datos para disfrutar de promociones personalizadas y un proceso de compra más ágil."}),e.jsxs("form",{onSubmit:U,noValidate:!0,children:[w?e.jsx("div",{className:`alert alert-${w.type}`,role:"alert",children:w.text}):null,e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",htmlFor:"runBody",children:"RUN"}),e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("input",{type:"text",id:"runBody",name:"runBody",className:`form-control${s.runBody||s.run?" is-invalid":""}`,inputMode:"numeric",pattern:"[0-9]*",placeholder:"19011022",value:r.runBody,onChange:M,onBlur:()=>I("runBody"),"aria-describedby":"runHelp",autoComplete:"off",maxLength:8,style:{flex:1}}),e.jsx("span",{className:"fw-semibold","aria-hidden":"true",children:"-"}),e.jsx("input",{type:"text",id:"runDigit",name:"runDigit",className:`form-control${s.runDigit||s.run?" is-invalid":""}`,inputMode:"text",pattern:"[0-9Kk]",placeholder:"K",value:r.runDigit,onChange:V,onBlur:()=>I("runDigit"),maxLength:1,style:{width:"4rem"},autoComplete:"off"})]}),e.jsx("div",{id:"runHelp",className:"form-text",children:"Ingresa los 7 u 8 dígitos y luego el dígito verificador."}),s.runBody?e.jsx("div",{className:"invalid-feedback d-block",children:s.runBody}):null,s.runDigit?e.jsx("div",{className:"invalid-feedback d-block",children:s.runDigit}):null,!s.runBody&&!s.runDigit&&s.run?e.jsx("div",{className:"invalid-feedback d-block",children:s.run}):null]}),e.jsx(f,{name:"nombre",label:"Nombre",placeholder:"María Luisa",value:r.nombre,onChange:p,onBlur:b,errorText:s.nombre}),e.jsx(f,{name:"apellidos",label:"Apellidos",placeholder:"Pérez González",value:r.apellidos,onChange:p,onBlur:b,errorText:s.apellidos}),e.jsx(f,{name:"correo",label:"Correo electrónico",placeholder:"usuario@dominio.com",type:"email",value:r.correo,onChange:p,onBlur:b,helperText:"Dominios permitidos: @duoc.cl, @profesor.duoc.cl, @gmail.com",errorText:s.correo}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-12 col-lg-6",children:[e.jsx("label",{className:"form-label fw-semibold",htmlFor:"birthdate",children:"Fecha de nacimiento (opcional)"}),e.jsx("input",{type:"date",id:"birthdate",name:"fechaNacimiento",className:`form-control${s.fechaNacimiento?" is-invalid":""}`,max:new Date().toISOString().split("T")[0],value:r.fechaNacimiento??"",onChange:p,onBlur:b}),s.fechaNacimiento?e.jsx("div",{className:"invalid-feedback d-block",children:s.fechaNacimiento}):e.jsxs("div",{className:"form-text",children:["Debes tener al menos ",Q," años."]})]}),e.jsx("div",{className:"col-12 col-lg-6",children:e.jsx(f,{name:"direccion",label:"Dirección",placeholder:"Calle 123",value:r.direccion,onChange:p,onBlur:b,errorText:s.direccion})})]}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-12 col-lg-6",children:[e.jsx("label",{className:"form-label fw-semibold",htmlFor:"region",children:"Región"}),e.jsxs("select",{id:"region",className:`form-select${s.regionId?" is-invalid":""}`,value:r.regionId,onChange:z,children:[e.jsx("option",{value:"",children:"Selecciona una región"}),y.map(a=>e.jsx("option",{value:a.id,children:a.region},a.id))]}),s.regionId?e.jsx("div",{className:"invalid-feedback d-block",children:s.regionId}):null]}),e.jsxs("div",{className:"col-12 col-lg-6",children:[e.jsx("label",{className:"form-label fw-semibold",htmlFor:"comuna",children:"Comuna"}),e.jsxs("select",{id:"comuna",className:`form-select${s.comuna?" is-invalid":""}`,disabled:!r.regionId,value:r.comuna,onChange:O,children:[e.jsx("option",{value:"",children:"Selecciona una comuna"}),F.map(a=>e.jsx("option",{value:a,children:a},a))]}),s.comuna?e.jsx("div",{className:"invalid-feedback d-block",children:s.comuna}):null]})]}),e.jsx(f,{name:"codigoDescuento",label:"Código promocional (opcional)",placeholder:"Ej: FELICES50",value:r.codigoDescuento??"",onChange:p,onBlur:b,errorText:s.codigoDescuento,helperText:"Ingresa tu código si cuentas con una campaña vigente."}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",htmlFor:"password",children:"Contraseña"}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{type:C?"text":"password",className:`form-control${s.password?" is-invalid":""}`,id:"password",name:"password",value:r.password,onChange:p,onBlur:b,"aria-describedby":"passwordHelp"}),e.jsx("button",{type:"button",className:"btn btn-pastel btn-mint",onClick:()=>L(a=>!a),"aria-label":C?"Ocultar contraseña":"Mostrar contraseña",children:e.jsx("i",{className:C?"bi bi-eye-slash":"bi bi-eye","aria-hidden":"true"})})]}),e.jsx("div",{id:"passwordHelp",className:"form-text",children:"Debe tener entre 4 y 10 caracteres."}),s.password?e.jsx("div",{className:"invalid-feedback d-block",children:s.password}):null]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",htmlFor:"confirmPassword",children:"Confirmar contraseña"}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{type:k?"text":"password",className:`form-control${s.confirmPassword?" is-invalid":""}`,id:"confirmPassword",name:"confirmPassword",value:r.confirmPassword,onChange:p,onBlur:b}),e.jsx("button",{type:"button",className:"btn btn-pastel btn-mint",onClick:()=>$(a=>!a),"aria-label":k?"Ocultar confirmación":"Mostrar confirmación",children:e.jsx("i",{className:k?"bi bi-eye-slash":"bi bi-eye","aria-hidden":"true"})})]}),s.confirmPassword?e.jsx("div",{className:"invalid-feedback d-block",children:s.confirmPassword}):null]}),e.jsxs("div",{className:"form-check mb-4",children:[e.jsx("input",{type:"checkbox",className:`form-check-input${s.termsAccepted?" is-invalid":""}`,id:"terms",name:"termsAccepted",checked:!!r.termsAccepted,onChange:R,onBlur:()=>{const a={...c,termsAccepted:!0};m(r,a),u(a)},required:!0}),e.jsxs("label",{className:"form-check-label",htmlFor:"terms",children:["Acepto los ",e.jsx("a",{className:"link-body-emphasis",href:"/terminos",children:"términos y condiciones"})]}),s.termsAccepted?e.jsx("div",{className:"invalid-feedback d-block",children:s.termsAccepted}):null]}),e.jsx("div",{className:"d-grid",children:e.jsx(P,{type:"submit",variant:"strawberry",size:"lg",children:"Crear cuenta"})}),e.jsx("hr",{className:"my-4"}),e.jsxs("p",{className:"mb-0 text-center",children:["¿Ya tienes cuenta?"," ",e.jsx(G,{to:"/login",className:"link-body-emphasis",onClick:H,children:"Inicia sesión"})]})]})]})})})})})]})};export{ie as default};
