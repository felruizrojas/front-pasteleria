import{u as B,a as I,r as o,j as e,L as O,e as T,k as V,h as $,c as L,s as F}from"./index-CtA74-58.js";import{I as M,B as A}from"./Input-CJ-O810F.js";import{b as D,f as z,a as H}from"./userValidations-DoQ_YzLs.js";const E=()=>({email:"",password:"",confirmPassword:""}),q=()=>{const d=B(),j=`${d.pathname}${d.search}`,N=I(),[h,g]=o.useState(!1),[p,y]=o.useState(!1),[i,P]=o.useState(E()),[l,f]=o.useState({}),[C,m]=o.useState({}),[b,u]=o.useState(null),[S,k]=o.useState(!1),R=o.useCallback(s=>{s.preventDefault(),N(`${d.pathname}${d.search}`,{replace:!0,state:{from:j,openLogin:!0}})},[j,d.pathname,d.search,N]),w=o.useCallback((s,a)=>{const c=D(s),t={};return Object.keys(a).forEach(r=>{if(!a[r])return;const n=c.errors[r];n&&(t[r]=n)}),f(t),c},[f]),x=s=>{const{name:a,value:c}=s.currentTarget,t=a,r={...i,[t]:c},n={...C,[t]:!0};w(r,n),P(r),m(n),u(null)},v=s=>{const{name:a}=s.currentTarget;if(!a)return;const t={...C,[a]:!0};w(i,t),m(t)},U=async s=>{s.preventDefault();const a={email:!0,password:!0,confirmPassword:!0},c=w(i,a);if(m(a),!c.isValid){u({type:"danger",text:"Corrige los campos marcados antes de continuar."});return}const t=i.email.trim().toLowerCase(),r=z(t);if(!r){u({type:"danger",text:T.userNotFound});return}k(!0);try{const n={...r,password:V(i.password),updatedAt:new Date().toISOString()};H(n),$(L.activeUser)?.id===n.id&&F(L.activeUser,n),P(E()),f({}),m({}),g(!1),y(!1),u({type:"success",text:"Contraseña actualizada con éxito. Ya puedes iniciar sesión con tu nueva contraseña."})}finally{k(!1)}};return e.jsx("main",{className:"container py-5",children:e.jsx("div",{className:"row justify-content-center",children:e.jsx("div",{className:"col-12 col-md-10 col-lg-6",children:e.jsxs("div",{className:"card shadow-soft p-4",children:[e.jsxs("header",{className:"text-center mb-4",children:[e.jsx("h1",{className:"h4 mb-2",children:"Restablecer contraseña"}),e.jsx("p",{className:"mb-0",children:"Ingresa tu correo y define tu nueva contraseña."})]}),e.jsxs("form",{onSubmit:U,noValidate:!0,children:[b?e.jsx("div",{className:`alert alert-${b.type}`,role:"alert",children:b.text}):null,e.jsx(M,{type:"email",name:"email",id:"resetEmail",label:"Correo electrónico",placeholder:"tucorreo@dominio.com",value:i.email,onChange:x,onBlur:v,errorText:l.email}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",htmlFor:"newPassword",children:"Nueva contraseña"}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{type:h?"text":"password",className:`form-control${l.password?" is-invalid":""}`,id:"newPassword",name:"password",value:i.password,onChange:x,onBlur:v,"aria-describedby":"newPasswordHelp"}),e.jsx("button",{type:"button",className:"btn btn-pastel btn-mint",onClick:()=>g(s=>!s),"aria-label":h?"Ocultar contraseña":"Mostrar contraseña",children:e.jsx("i",{className:h?"bi bi-eye-slash":"bi bi-eye","aria-hidden":"true"})})]}),e.jsx("div",{id:"newPasswordHelp",className:"form-text",children:"Debe tener entre 4 y 10 caracteres."}),l.password?e.jsx("div",{className:"invalid-feedback d-block",children:l.password}):null]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"form-label fw-semibold",htmlFor:"confirmPassword",children:"Confirmar contraseña"}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{type:p?"text":"password",className:`form-control${l.confirmPassword?" is-invalid":""}`,id:"confirmPassword",name:"confirmPassword",value:i.confirmPassword,onChange:x,onBlur:v}),e.jsx("button",{type:"button",className:"btn btn-pastel btn-mint",onClick:()=>y(s=>!s),"aria-label":p?"Ocultar confirmación":"Mostrar confirmación",children:e.jsx("i",{className:p?"bi bi-eye-slash":"bi bi-eye","aria-hidden":"true"})})]}),l.confirmPassword?e.jsx("div",{className:"invalid-feedback d-block",children:l.confirmPassword}):null]}),e.jsx(A,{type:"submit",block:!0,variant:"strawberry",disabled:S,children:S?"Actualizando...":"Restablecer contraseña"}),e.jsx("p",{className:"text-center mt-4 mb-0",children:e.jsxs("small",{children:["¿Recuerdas tu contraseña?"," ",e.jsx(O,{to:"/login",className:"link-body-emphasis",onClick:R,children:"Volver al inicio de sesión"})]})})]})]})})})})};export{q as default};
