import{e as t,A as w,g as f,c as m,k as h,f as P,l as E}from"./index-CqkjqQ36.js";const A=18,I=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,D=/^[\p{L}\s´¨]+$/u,x=/[^\p{L}\s´¨]/gu,K=o=>o.replace(x,""),C=/^[0-9]{7,8}$/,M=/^[0-9K]$/i,L=o=>o.replace(/[^0-9kK]/g,"").toUpperCase(),_=o=>{let r=0,e=2;for(let s=o.length-1;s>=0;s-=1)r+=Number(o[s])*e,e=e===7?2:e+1;const i=11-r%11;return i===11?"0":i===10?"K":String(i)},q=o=>{const r=L(o);if(!/^[0-9]{7,8}[0-9K]$/.test(r))return!1;const e=r.slice(0,-1),i=r.slice(-1);return _(e)===i},B=(o,r=A)=>{if(!o)return!0;const e=new Date(o);if(Number.isNaN(e.getTime()))return!1;const i=new Date;let s=i.getFullYear()-e.getFullYear();const n=i.getMonth()-e.getMonth();return(n<0||n===0&&i.getDate()<e.getDate())&&(s-=1),s>=r},U=o=>f(m.regiones).find(e=>e.id===o),F=(o,r)=>{const e=f(m.usuarios),i=o.trim().toLowerCase();return e.some(s=>s.correo.toLowerCase()===i&&s.id!==r)},O=(o,r)=>{const e=f(m.usuarios),i=L(o);return e.some(s=>L(s.run)===i&&s.id!==r)},T=(o,r)=>{const e={},i=o.runBody?.trim()??"",s=o.runDigit?.trim().toUpperCase()??"",n=i&&s?`${i}${s}`:"",l=o.nombre?.trim()??"",c=o.apellidos?.trim()??"",d=o.correo?.trim()??"",g=o.direccion?.trim()??"",u=o.regionId?.trim()??"",y=o.comuna?.trim()??"",a=o.password?.trim()??"",p=o.confirmPassword?.trim()??"",N=!!o.termsAccepted;if(i?C.test(i)?i.startsWith("0")&&(e.runBody=t.runLeadingZero):e.runBody="El RUN debe contener 7 u 8 dígitos numéricos":e.runBody="Ingresa los 7 u 8 dígitos del RUN",s?M.test(s)||(e.runDigit="El dígito verificador debe ser un número o K"):e.runDigit="Ingresa el dígito verificador",!e.runBody&&!e.runDigit&&(n?q(n)?O(n,o.id)&&(e.run=t.duplicateRun):e.run=t.runFormat:e.run=t.required("El RUN completo")),l?D.test(l)?l.length>50&&(e.nombre=t.maxLength("El nombre",50)):e.nombre=t.lettersOnly("El nombre"):e.nombre=t.required("El nombre"),c?D.test(c)?c.length>100&&(e.apellidos=t.maxLength("Los apellidos",100)):e.apellidos=t.lettersOnly("Los apellidos"):e.apellidos=t.required("Los apellidos"),!d)e.correo=t.required("El correo");else if(d.length>100)e.correo=t.maxLength("El correo",100);else if(!I.test(d))e.correo=t.emailFormat;else{const b=d.toLowerCase().split("@")[1]??"";w.some(R=>R===b)?F(d,o.id)&&(e.correo=t.duplicateEmail):e.correo=t.emailDomain([...w])}return o.fechaNacimiento&&(B(o.fechaNacimiento)||(e.fechaNacimiento=t.ageRestriction(A))),u?U(u)||(e.regionId="La región seleccionada no es válida"):e.regionId=t.selectionRequired("región"),y||(e.comuna=t.selectionRequired("comuna")),g?g.length>300&&(e.direccion=t.maxLength("La dirección",300)):e.direccion=t.required("La dirección"),r.mode==="create"?(a?(a.length<4||a.length>10)&&(e.password="La contraseña debe tener entre 4 y 10 caracteres"):e.password=t.required("La contraseña"),p?a&&a!==p&&(e.confirmPassword=t.passwordMismatch):e.confirmPassword=t.required("La confirmación de contraseña"),N||(e.termsAccepted=t.acceptTerms)):a&&((a.length<4||a.length>10)&&(e.password="La contraseña debe tener entre 4 y 10 caracteres"),p&&a!==p&&(e.confirmPassword=t.passwordMismatch)),{isValid:Object.keys(e).length===0,errors:e}},X=o=>{const r={},e=o.email?.trim()??"",i=o.password?.trim()??"",s=o.confirmPassword?.trim()??"";if(!e)r.email=t.required("El correo");else if(e.length>100)r.email=t.maxLength("El correo",100);else if(!I.test(e))r.email=t.emailFormat;else{const n=e.toLowerCase().split("@")[1]??"";w.some(c=>c===n)?S(e)||(r.email=t.userNotFound):r.email=t.emailDomain([...w])}return i?(i.length<4||i.length>10)&&(r.password="La contraseña debe tener entre 4 y 10 caracteres"):r.password=t.required("La contraseña"),s?i&&i!==s&&(r.confirmPassword=t.passwordMismatch):r.confirmPassword=t.required("La confirmación de contraseña"),{isValid:Object.keys(r).length===0,errors:r}},$=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`user-${Date.now()}`,k=(o,r)=>{const e=U(o.regionId),i=new Date().toISOString(),s=o.password?.trim()??"",n=r?.password??"",l=s?h(s):h(n),c=o.id??r?.id??$(),d=o.avatarUrl?.trim()||r?.avatarUrl||P,g=r?.tipoUsuario??"Cliente",u=o.codigoDescuento?.trim().toUpperCase()||r?.codigoDescuento;return{id:c,run:L(`${o.runBody}${o.runDigit}`),nombre:o.nombre.trim(),apellidos:o.apellidos.trim(),correo:o.correo.trim().toLowerCase(),fechaNacimiento:o.fechaNacimiento||r?.fechaNacimiento||void 0,tipoUsuario:g,regionId:o.regionId,regionNombre:e?.region??o.regionId,comuna:o.comuna.trim(),direccion:o.direccion.trim(),password:l,avatarUrl:d,codigoDescuento:u,createdAt:r?.createdAt??i,updatedAt:i}},V=o=>{const r=f(m.usuarios),e=r.findIndex(s=>s.id===o.id);if(e===-1)return r.push(o),E(m.usuarios,r),r;const i=r[e];return i.tipoUsuario==="SuperAdmin"||(r[e]={...i,...o,createdAt:i.createdAt??o.createdAt,tipoUsuario:i.tipoUsuario},E(m.usuarios,r)),r},S=o=>{const r=f(m.usuarios),e=o.trim().toLowerCase();return r.find(i=>i.correo.toLowerCase()===e)};export{A as M,V as a,X as b,S as f,k as m,K as s,T as v};
